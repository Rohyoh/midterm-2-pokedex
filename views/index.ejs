<<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
    <title>Pokédex</title>
</head>
<body class="body">
    <header class="dinamic-header">
        <div class="container-fluid">
            <div class="title-container">
                <h1 class="title">POKÉDEX</h1>
                <img class="logo" alt="logo" src="images/pokeball.png"/>
            </div>
        </div>
    </header>

<div class="container mt-4">
    <nav>
        <ul class="pagination" id="pagination">
            <li class="page-item"><button class="page-link" onclick="loadPokemonGrid(1, 100)">1</button></li>
            <li class="page-item"><button class="page-link" onclick="loadPokemonGrid(101, 200)">2</button></li>
            <li class="page-item"><button class="page-link" onclick="loadPokemonGrid(201, 300)">3</button></li>
            <li class="page-item"><button class="page-link" onclick="loadPokemonGrid(301, 400)">4</button></li>
            <li class="page-item"><button class="page-link" onclick="loadPokemonGrid(401, 500)">5</button></li>
            <li class="page-item"><button class="page-link" onclick="loadPokemonGrid(501, 600)">6</button></li>
            <li class="page-item"><button class="page-link" onclick="loadPokemonGrid(601, 700)">7</button></li>
            <li class="page-item"><button class="page-link" onclick="loadPokemonGrid(701, 800)">8</button></li>
            <li class="page-item"><button class="page-link" onclick="loadPokemonGrid(801, 900)">9</button></li>
            <li class="page-item"><button class="page-link" onclick="loadPokemonGrid(901, 1000)">10</button></li>
        </ul>
    </nav>
</div>

    <div class="container mt-4">
        <div class="row" id="pokemonGrid">
            <!-- Pokémon -->
        </div>
    </div>

    <!-- Pokémon Modal -->
    <div class="modal fade" id="pokemonModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header" id="modalHeader">
                    <h5 class="modal-title" id="modalTitle"></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-4 text-center">
                            <img id="modalImage" src="" class="img-fluid" alt="">
                            <h4 id="modalName" class="mt-2"></h4>
                            <p>ID: <span id="modalId"></span></p>
                            <div id="modalTypes" class="mb-3"></div>
                        </div>
                        <div class="col-md-8">
                            <div class="row">
                                <div class="col-md-6">
                                    <h5>Base Stats</h5>
                                    <div id="modalStats"></div>
                                    
                                    <h5 class="mt-3">Physical Characteristics</h5>
                                    <p>Weight: <span id="modalWeight"></span></p>
                                    <p>Height: <span id="modalHeight"></span></p>
                                    <p>Base xp: <span id="modalExperience"></span></p>
                                </div>
                                <div class="col-md-6">
                                    <h5>Abilities</h5>
                                    <div id="modalAbilities"></div>
                                    
                                    <h5 class="mt-3">Moves</h5>
                                    <div id="modalMoves" class="moves-container"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        //modal color map :))
        const typeColors = {
            normal: '#A8A878',
            fire: '#F08030',
            water: '#6890F0',
            electric: '#F8D030',
            grass: '#78C850',
            ice: '#98D8D8',
            fighting: '#C03028',
            poison: '#A040A0',
            ground: '#E0C068',
            flying: '#A890F0',
            psychic: '#F85888',
            bug: '#A8B820',
            rock: '#B8A038',
            ghost: '#705898',
            dragon: '#7038F8',
            dark: '#705848',
            steel: '#B8B8D0',
            fairy: '#EE99AC'
        };

       //Pokémon grid
async function loadPokemonGrid(start, end) {
    const grid = document.getElementById('pokemonGrid');
    const pagination = [...document.getElementsByClassName('page-link')];
    pagination.forEach(button => {
        button.disabled = true;
    });
    

    [...grid.children].forEach(child => child.remove());
    
    try {
        for (let i = start; i <= end; i++) {
            try {
                const response = await fetch(`/pokemon/${i}`);
                const pokemon = await response.json();
                
                //vvvv here we force the grid images to be front sprites of the pokémons 
                const frontImage = pokemon.images.find(img => 
                    img.includes('front_default') || 
                    !img.includes('back') 
                ) || pokemon.images[0];
                
                const col = document.createElement('div');
                col.className = 'col-md-2 mb-3';
                col.innerHTML = `
                    <div class="card pokemon-card" data-id="${pokemon.id}">
                        <img src="${frontImage}" class="card-img-top" alt="${pokemon.name}">
                        <div class="card-body text-center">
                            <h6 class="card-title">${pokemon.name.charAt(0).toUpperCase() + pokemon.name.slice(1)}</h6>
                            <p class="card-text small">ID: ${pokemon.id}</p>
                            <div class="types-container">
                                ${pokemon.types.map(type => 
                                    `<span class="type-badge" style="background-color: ${typeColors[type]}">${type}</span>`
                                ).join('')}
                            </div>
                        </div>
                    </div>
                `;
                grid.appendChild(col);
            } catch (error) {
                console.error(`Failed to load Pokémon ${i}:`, error);
            }
        }
    } finally {
        pagination.forEach(button => {
            button.disabled = false;
        });
    }

    //event listeners
    document.querySelectorAll('.pokemon-card').forEach(card => {
        card.addEventListener('click', () => showPokemonDetails(card.dataset.id));
    });
}

        //Pokémon details in modal vvvvvv
        async function showPokemonDetails(id) {
            try {
                const response = await fetch(`/pokemon/${id}`);
                const pokemon = await response.json();
                
                //modal color :D
                const primaryType = pokemon.types[0];
                document.getElementById('modalHeader').style.backgroundColor = typeColors[primaryType];
                
                //info
                document.getElementById('modalTitle').textContent = `${pokemon.name} Details`;
                document.getElementById('modalImage').src = pokemon.images[0];
                document.getElementById('modalName').textContent = pokemon.name;
                document.getElementById('modalId').textContent = pokemon.id;
                
                //types
                const typesContainer = document.getElementById('modalTypes');
                typesContainer.innerHTML = pokemon.types.map(type => 
                    `<span class="type-badge" style="background-color: ${typeColors[type]}">${type}</span>`
                ).join('');
                
                //stats
                const statsContainer = document.getElementById('modalStats');
                statsContainer.innerHTML = pokemon.stats.map(stat => 
                    `<p>${stat.name}: ${stat.value}</p>`
                ).join('');
                
                //physical characteristics
                document.getElementById('modalWeight').textContent = pokemon.weight;
                document.getElementById('modalHeight').textContent = pokemon.height;
                document.getElementById('modalExperience').textContent = pokemon.experience;
                
                //abilities
                const abilitiesContainer = document.getElementById('modalAbilities');
                abilitiesContainer.innerHTML = pokemon.abilities.map(ability => 
                    `<span class="ability-badge">${ability}</span>`
                ).join('');
                
                //moves (limited to 10, some of them are lenghty xd)
                const movesContainer = document.getElementById('modalMoves');
                const movesToShow = pokemon.moves.slice(0, 10);
                movesContainer.innerHTML = movesToShow.map(move => 
                    `<span class="move-badge">${move}</span>`
                ).join('');
                
                //Render modal
                const modal = new bootstrap.Modal(document.getElementById('pokemonModal'));
                modal.show();
                
            } catch (error) {//bomboclaaaaaaaaaaaat
                console.error('bomboclaaaaaaaaaaaat:', error);
            }
        }

        // Load grid when page is ready, yessirrrrr
        document.addEventListener('DOMContentLoaded',loadPokemonGrid(1,100));
    </script>
</body>
</html>